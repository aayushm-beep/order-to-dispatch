<div class="dashboard" *ngIf="summary() as data; else loadingTemplate">
  <div class="summary-grid">
    <mat-card class="summary-card" *ngFor="let item of [
      { icon: 'assignment', label: 'Orders', value: data.totals.orders | number },
      { icon: 'local_shipping', label: 'Shipments', value: data.totals.shipments | number },
      { icon: 'warehouse', label: 'Warehouses', value: data.totals.warehouses | number },
      { icon: 'payments', label: 'Order Value', value: '$' + (data.totals.order_value | number : '1.0-0') }
    ]">
      <div class="summary-icon">
        <mat-icon>{{ item.icon }}</mat-icon>
      </div>
      <div class="summary-content">
        <span class="summary-value">{{ item.value }}</span>
        <span class="summary-label">{{ item.label }}</span>
      </div>
    </mat-card>
  </div>

  <div class="detail-grid">
    <mat-card class="detail-card">
      <div class="card-header">
        <h3>Pipeline Status</h3>
        <mat-chip color="primary" selected>{{ data.late_orders }} Late Risk</mat-chip>
      </div>
      <div class="pipeline-chart">
        <div class="pipeline-row" *ngFor="let entry of pipelineEntries(data)">
          <span class="pipeline-label">{{ entry[0] }}</span>
          <div class="pipeline-bar">
            <div class="pipeline-bar-fill" [style.width.%]="entry[1] / data.totals.orders * 100"></div>
          </div>
          <span class="pipeline-value">{{ entry[1] }}</span>
        </div>
      </div>
    </mat-card>

    <mat-card class="detail-card">
      <div class="card-header">
        <h3>Network Utilization</h3>
        <span>{{ data.warehouse_utilization * 100 | number : '1.0-0' }}% Average</span>
      </div>
      <mat-progress-bar mode="determinate" [value]="data.warehouse_utilization * 100"></mat-progress-bar>
      <p class="card-description">
        Monitoring warehouse saturation enables proactive staffing and replenishment decisions across the network.
      </p>
    </mat-card>

    <mat-card class="detail-card" *ngIf="overview() as forecast">
      <div class="card-header">
        <h3>Demand vs. Supply Outlook</h3>
        <button mat-stroked-button color="primary" (click)="refresh()">Refresh</button>
      </div>
      <div class="chart-legend">
        <span class="legend demand">Demand</span>
        <span class="legend supply">Supply</span>
      </div>
      <div class="chart-grid">
        <div class="chart-row" *ngFor="let label of forecast.labels; let i = index">
          <span class="chart-label">{{ label }}</span>
          <div class="chart-bars">
            <div class="bar demand" [style.width.%]="forecast.demand[i] / 20"></div>
            <div class="bar supply" [style.width.%]="forecast.supply[i] / 20"></div>
          </div>
        </div>
      </div>
    </mat-card>
  </div>
</div>

<ng-template #loadingTemplate>
  <div class="loading-state" *ngIf="loading(); else errorTemplate">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <span>Loading dashboard insights...</span>
  </div>
</ng-template>

<ng-template #errorTemplate>
  <div class="loading-state">
    <span>Unable to load dashboard data. Please try again.</span>
  </div>
</ng-template>
