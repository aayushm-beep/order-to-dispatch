<div class="forecast-page" *ngIf="settings() as config; else loadingTemplate">
  <mat-card class="config-card">
    <div class="card-header">
      <div>
        <h2>Forecast Model Configuration</h2>
        <p>Orchestrate demand planning horizons and levers for the next {{ config.horizon_months }} months.</p>
      </div>
      <button mat-raised-button color="primary" (click)="loadSettings()">Reload</button>
    </div>

    <div class="config-grid">
      <div class="config-block">
        <mat-form-field appearance="outline">
          <mat-label>Model</mat-label>
          <input matInput [value]="config.model" readonly />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Horizon (months)</mat-label>
          <input matInput [value]="config.horizon_months" readonly />
        </mat-form-field>
      </div>

      <div class="config-block">
        <label class="slider-label">Confidence Interval: {{ confidenceLabel() }}</label>
        <mat-slider
          [min]="0.5"
          [max]="0.99"
          [step]="0.01"
          thumbLabel
          [value]="confidence()"
          (valueChange)="confidence.set($event)"
        ></mat-slider>
      </div>

      <div class="config-block">
        <h3>Seasonality Components</h3>
        <mat-slide-toggle [checked]="config.seasonality.weekly" disabled>Weekly</mat-slide-toggle>
        <mat-slide-toggle [checked]="config.seasonality.monthly" disabled>Monthly</mat-slide-toggle>
        <mat-slide-toggle [checked]="config.seasonality.yearly" disabled>Yearly</mat-slide-toggle>
      </div>

      <div class="config-block">
        <h3>Demand Drivers</h3>
        <mat-chip-set>
          <mat-chip *ngFor="let driver of config.demand_drivers" color="primary" selected>{{ driver }}</mat-chip>
        </mat-chip-set>
      </div>

      <div class="config-block">
        <h3>Scenario Library</h3>
        <mat-form-field appearance="outline">
          <mat-label>Select Scenario</mat-label>
          <mat-select (selectionChange)="selectScenario($event.value)" [value]="selectedScenario()?.name">
            <mat-option *ngFor="let scenario of config.scenarios" [value]="scenario.name">
              {{ scenario.name }} ({{ scenario.growth * 100 | number : '1.0-0' }}% growth)
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div class="scenario-details" *ngIf="selectedScenario() as scenario">
          <p>
            Applying the <strong>{{ scenario.name }}</strong> scenario scales baseline demand by
            <strong>{{ scenario.growth * 100 | number : '1.0-0' }}%</strong>.
          </p>
          <p class="helper">
            Update scenario levers to stress test capacity, sourcing, and fulfillment operations across the network.
          </p>
        </div>
      </div>
    </div>
  </mat-card>
</div>

<ng-template #loadingTemplate>
  <div class="loading-state" *ngIf="loading(); else errorTemplate">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <span>Loading forecasting controls...</span>
  </div>
</ng-template>

<ng-template #errorTemplate>
  <div class="loading-state">
    <span>Unable to load forecast settings.</span>
  </div>
</ng-template>
